<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WidgetApp</title>
    <script type="text/javascript" src="https://static.parastorage.com/services/js-sdk/1.95.0/js/wix-private.js"></script>
</head>
<body style='border:2px solid black; background-color: white;'>
<p>Enable TPA to expose API to WixCode from viewerScript</p>
<button onClick="clearName()">Clear Result</button>
<p id="printUser"></p>

</body>
</html>

<script>
    //clear printUser field that was filled by function before
    function clearName() {
        document.getElementById("printUser").innerHTML = null;
    }

    //printUserName
    var userName = [];

    function printUser(userData) {
        document.getElementById("printUser").innerHTML = userData;
    }

    function getName (options, callback) {
        userName.push(options);
        callback(options);
    }


    //openPopUp
    var position =  {origin: Wix.WindowOrigin.FIXED, placement: Wix.WindowPlacement.CENTER};
    var onClose = function(message) { console.log("popup closed", message) };

    function openPopUp(url) {
        Wix.openPopup(url, 400, 400, position, onClose);
    }

    //navigate to second page
    function navigateToPage() {
        Wix.getSiteMap(function(siteMap) {
            var page_id = siteMap[1].pageId.substr(1);
            Wix.navigateToPage(page_id);
        });
    }


    var getApi = function() {
        clearName();
        Wix.getPublicAPI({appDefinitionId: "1519ae3f-32f6-5599-4196-7a9661eda3d5"}, function (api) {
            Wix.getComponentInfo(function (info) {
                const compId = info.compId;
                console.log(api);
                api.registerOpenPopUpFunction(openPopUp);
                api.registerNavigate(navigateToPage);
                api.registerGetName(getName);
                api.registerPrintUser(printUser);
            });
        }, function (error) {
            console.log(error);
        });
    }

    getApi();

    Wix.addEventListener(Wix.Events.PAGE_NAVIGATION, getApi);

</script>

